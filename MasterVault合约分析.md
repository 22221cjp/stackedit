<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MasterVault合约分析</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="mastervault合约分析">MasterVault合约分析</h1>
<p>这几个Token注意下：</p>
<ul>
<li>ceABNBc（ceToken）
<ul>
<li>MasterVault合约vaultToken</li>
<li>HelioProviderV2合约_ceToken</li>
</ul>
</li>
<li>hBNB
<ul>
<li>HelioProviderV2合约_collateralToken</li>
</ul>
</li>
<li>slisBNB
<ul>
<li><a href="https://bscscan.com/address/0xB0b84D294e0C75A6abe60171b70edEb2EFd14A1B">https://bscscan.com/address/0xB0b84D294e0C75A6abe60171b70edEb2EFd14A1B</a></li>
<li>ListaStakeManager#slisBnb</li>
<li>SnBnbYieldConverterStrategy#_snBnbToken</li>
</ul>
</li>
<li>_pool
<ul>
<li>HelioProviderV2#_pool</li>
<li></li>
</ul>
</li>
</ul>
<p>HelioProviderV2有两个方法：</p>
<ol>
<li>release</li>
<li>releaseInToken</li>
</ol>
<p>第一个方法会获取bnb，第二个方法获取的是slisBNB，现在修改的逻辑是第一个提取bnb如果不够，直接拒绝，用户可以通过releaseInToken获取slisBNB。</p>
<p>用户清算的时候HelioProviderV2#liquidation就是调用的releaseInToken获取slisBNB。</p>
<p>现在提取ETH，</p>
<p>BNBStakingPool_R4(<a href="https://bscscan.com/address/0x9e347Af362059bf2E55839002c699F7A5BaFE86E#readProxyContract">https://bscscan.com/address/0x9e347Af362059bf2E55839002c699F7A5BaFE86E#readProxyContract</a>)</p>
<p>HelioProviderV2线上的合约地址，BNB(ceABNBc)的helioProviders<br>
<a href="https://bscscan.com/address/0xa835F890Fcde7679e7F7711aBfd515d2A267Ed0B#readProxyContract">https://bscscan.com/address/0xa835F890Fcde7679e7F7711aBfd515d2A267Ed0B#readProxyContract</a></p>
<p>HelioETHProvider线上合约地址，ETH(cewBETH)的helioProviders<br>
<a href="https://bscscan.com/address/0x0326c157bfF399e25dd684613aEF26DBb40D3BA4#readProxyContract">https://bscscan.com/address/0x0326c157bfF399e25dd684613aEF26DBb40D3BA4#readProxyContract</a></p>
<p>CerosETHRouter：<br>
<a href="https://bscscan.com/address/0xA0cD5EAfa37EBA1d04Fb003512f962f2f73C3e86#readProxyContract">https://bscscan.com/address/0xA0cD5EAfa37EBA1d04Fb003512f962f2f73C3e86#readProxyContract</a></p>
<p>ETH提现手续费收取，是getReferral</p>
<p>referral: <a href="https://bscscan.com/address/0x00b22a426aC5928cA5cEb5FcfE9066587CbD0b26#readProxyContract">https://bscscan.com/address/0x00b22a426aC5928cA5cEb5FcfE9066587CbD0b26#readProxyContract</a></p>
<p>这个referral是一个合约，名称： GnosisSafeL2<br>
referral无法修改</p>
<p>CeETHVault:<br>
<a href="https://bscscan.com/address/0xA230805C28121cc97B348f8209c79BEBEa3839C0#readProxyContract">https://bscscan.com/address/0xA230805C28121cc97B348f8209c79BEBEa3839C0#readProxyContract</a></p>
<p>ETH这里有3个token:</p>
<p>certToken<br>
<a href="https://bscscan.com/token/0x2170Ed0880ac9A755fd29B2688956BD959F933F8">Binance-Peg Ethereum Token (ETH)</a></p>
<p>ceToken<br>
<a href="https://bscscan.com/token/0x6C813D1d114d0caBf3F82f9E910BC29fE7f96451">CEROS wBETH Vault Token (cewBETH)</a></p>
<p>_BETH<br>
<a href="https://bscscan.com/token/0xa2E3356610840701BDf5611a53974510Ae27E2e1">Wrapped Binance Beacon ETH (wBETH)</a></p>
<p>certToken是ETH， ceToken是 cewBETH,  _BETH是wBETH</p>
<p>ceToken作为抵押物抵押到DAO,   ETH 20%, 80% wBETH转到vault</p>
<p>ETH和cewBETH 按照_BETH.exchangeRate();的关系转换</p>
<p>清算的时候，</p>
<p>目前MasterVault合约的depositFee和withdrawalFee都配置成0，也就是用户充值和提现不收取额外的手续费。所以手续费收入的字段feeEarned永远为0</p>
<p>MasterVault:<br>
0x986b40C2618fF295a49AC442c5ec40febB26CC54</p>
<p>ListaStakeManager线上合约地址：<br>
<a href="https://bscscan.com/address/0x1adB950d8bB3dA4bE104211D5AB038628e477fE6#readProxyContract">https://bscscan.com/address/0x1adB950d8bB3dA4bE104211D5AB038628e477fE6#readProxyContract</a></p>
<p>从MasterVault定时转移存款到strategy，同时又转到ListaStakeManager，线上一个交易：<br>
<a href="https://bscscan.com/tx/0x17b3028dc48a6e0f8aace0d9e5c8013643b208571ff4c97bdc99da1b83c529c4">https://bscscan.com/tx/0x17b3028dc48a6e0f8aace0d9e5c8013643b208571ff4c97bdc99da1b83c529c4</a></p>
<hr>
<p>address creditContract = IStakeHub(STAKE_HUB).getValidatorCreditContract(_validator);</p>
<p>STAKE_HUB:  0x0000000000000000000000000000000000002002</p>
<p><a href="https://bscscan.com/address/0x0000000000000000000000000000000000002002#readContract">https://bscscan.com/address/0x0000000000000000000000000000000000002002#readContract</a></p>
<h2 id="策略之间的继承关系">策略之间的继承关系</h2>
<pre class=" language-mermaid"><svg id="mermaid-svg-BmFy9q08xiQnwmLC" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="827.47265625" style="max-width: 2180.3203125px;" viewBox="-20 -20 2180.3203125 827.47265625"><style>#mermaid-svg-BmFy9q08xiQnwmLC{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-BmFy9q08xiQnwmLC .error-icon{fill:#552222;}#mermaid-svg-BmFy9q08xiQnwmLC .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-BmFy9q08xiQnwmLC .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-BmFy9q08xiQnwmLC .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-BmFy9q08xiQnwmLC .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-BmFy9q08xiQnwmLC .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-BmFy9q08xiQnwmLC .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-BmFy9q08xiQnwmLC .marker{fill:#666;stroke:#666;}#mermaid-svg-BmFy9q08xiQnwmLC .marker.cross{stroke:#666;}#mermaid-svg-BmFy9q08xiQnwmLC svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-BmFy9q08xiQnwmLC g.classGroup text{fill:#999;fill:#111111;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-svg-BmFy9q08xiQnwmLC g.classGroup text .title{font-weight:bolder;}#mermaid-svg-BmFy9q08xiQnwmLC .classTitle{font-weight:bolder;}#mermaid-svg-BmFy9q08xiQnwmLC .node rect,#mermaid-svg-BmFy9q08xiQnwmLC .node circle,#mermaid-svg-BmFy9q08xiQnwmLC .node ellipse,#mermaid-svg-BmFy9q08xiQnwmLC .node polygon,#mermaid-svg-BmFy9q08xiQnwmLC .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-BmFy9q08xiQnwmLC .divider{stroke:#999;stroke:1;}#mermaid-svg-BmFy9q08xiQnwmLC g.clickable{cursor:pointer;}#mermaid-svg-BmFy9q08xiQnwmLC g.classGroup rect{fill:#eee;stroke:#999;}#mermaid-svg-BmFy9q08xiQnwmLC g.classGroup line{stroke:#999;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC .classLabel .box{stroke:none;stroke-width:0;fill:#eee;opacity:0.5;}#mermaid-svg-BmFy9q08xiQnwmLC .classLabel .label{fill:#999;font-size:10px;}#mermaid-svg-BmFy9q08xiQnwmLC .relation{stroke:#666;stroke-width:1;fill:none;}#mermaid-svg-BmFy9q08xiQnwmLC .dashed-line{stroke-dasharray:3;}#mermaid-svg-BmFy9q08xiQnwmLC #compositionStart,#mermaid-svg-BmFy9q08xiQnwmLC .composition{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #compositionEnd,#mermaid-svg-BmFy9q08xiQnwmLC .composition{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #dependencyStart,#mermaid-svg-BmFy9q08xiQnwmLC .dependency{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #dependencyStart,#mermaid-svg-BmFy9q08xiQnwmLC .dependency{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #extensionStart,#mermaid-svg-BmFy9q08xiQnwmLC .extension{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #extensionEnd,#mermaid-svg-BmFy9q08xiQnwmLC .extension{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #aggregationStart,#mermaid-svg-BmFy9q08xiQnwmLC .aggregation{fill:#eee !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC #aggregationEnd,#mermaid-svg-BmFy9q08xiQnwmLC .aggregation{fill:#eee !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-BmFy9q08xiQnwmLC .edgeTerminals{font-size:11px;}#mermaid-svg-BmFy9q08xiQnwmLC:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-BmFy9q08xiQnwmLC class{fill:apa;}</style><g></g><defs><marker id="extensionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker id="extensionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker id="compositionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="compositionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g id="classid-IBaseStrategy-27" class="classGroup" transform="translate(848.23828125,0 )"><rect x="0" y="0" width="301.0546875" height="208.140625" class=" "></rect><text y="15" x="0"><tspan class="title" x="119.25">IBaseStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="301.0546875"></line><text x="5" y="31.55078125" fill="white" class="classText"></text><line x1="0" y1="26.55078125" y2="26.55078125" x2="301.0546875"></line><text x="5" y="41.55078125" fill="white" class="classText"><tspan x="5">+deposit() : uint256</tspan><tspan x="5" dy="10">+depositAll()</tspan><tspan x="5" dy="10">+withdraw(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+withdrawInToken(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+estimateInToken(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+harvest()</tspan><tspan x="5" dy="10">+panic() : uint256</tspan><tspan x="5" dy="10">+pause()</tspan><tspan x="5" dy="10">+unpause()</tspan><tspan x="5" dy="10">+balanceOf() : uint256</tspan><tspan x="5" dy="10">+balanceOfToken() : uint256</tspan><tspan x="5" dy="10">+balanceOfWant() : uint256</tspan><tspan x="5" dy="10">+balanceOfPool() : uint256</tspan><tspan x="5" dy="10">+setRewards(address newFeeRecipient)</tspan><tspan x="5" dy="10">+canDeposit(uint256 amount) : bool</tspan><tspan x="5" dy="10">+assessDepositFee(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+vault() : IMasterVault</tspan></text></g><g id="classid-BaseStrategy-28" class="classGroup" transform="translate(789.51953125,258.140625 )"><rect x="0" y="0" width="418.4921875" height="169.640625" class=" "></rect><text y="15" x="0"><tspan class="title" x="179.36328125">BaseStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="418.4921875"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">+address strategist</tspan><tspan x="5" dy="10">+address destination</tspan><tspan x="5" dy="10">+address rewards</tspan><tspan x="5" dy="10">+bool depositPaused</tspan><tspan x="5" dy="10">+IMasterVault vault</tspan></text><line x1="0" y1="78.05078125" y2="78.05078125" x2="418.4921875"></line><text x="5" y="93.05078125" fill="white" class="classText"><tspan x="5">+__BaseStrategy_init(address destinationAddr, address rewardsAddr, address masterVault)</tspan><tspan x="5" dy="10">+balanceOfWant() : uint256</tspan><tspan x="5" dy="10">+balanceOfPool() : uint256</tspan><tspan x="5" dy="10">+balanceOf() : uint256</tspan><tspan x="5" dy="10">+pause()</tspan><tspan x="5" dy="10">+unpause()</tspan><tspan x="5" dy="10">+setStrategist(address newStrategist)</tspan><tspan x="5" dy="10">+setRewards(address newRewardsAddr)</tspan></text></g><g id="classid-SnBnbYieldConverterStrategy-29" class="classGroup" transform="translate(0,477.78125 )"><rect x="0" y="0" width="445.2890625" height="309.69140625" class=" "></rect><text y="15" x="0"><tspan class="title" x="153.98046875">SnBnbYieldConverterStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="445.2890625"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">+IERC20Upgradeable _snBnbToken</tspan><tspan x="5" dy="10">+ISnBnbStakeManager _stakeManager</tspan><tspan x="5" dy="10">+uint256 _firstDistributeIdx</tspan><tspan x="5" dy="10">+uint256 _nextWithdrawIdx</tspan><tspan x="5" dy="10">+uint256 bnbDepositBalance</tspan><tspan x="5" dy="10">+uint256 snBnbToUnstake</tspan><tspan x="5" dy="10">+uint256 bnbToDistribute</tspan><tspan x="5" dy="10">+uint256 lastUnstakeTriggerTime</tspan></text><line x1="0" y1="108.1015625" y2="108.1015625" x2="445.2890625"></line><text x="5" y="123.1015625" fill="white" class="classText"><tspan x="5">+mapping(uint256 =&gt; UserWithdrawRequest) : _withdrawRequests</tspan><tspan x="5" dy="10">+mapping(address =&gt; uint256) : manualWithdrawAmount</tspan><tspan x="5" dy="10">+initialize(address destination, address rewardsAddr, address snBnbToken, address masterVault)</tspan><tspan x="5" dy="10">+deposit() : uint256</tspan><tspan x="5" dy="10">+depositAll()</tspan><tspan x="5" dy="10">+withdraw(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+withdrawInToken(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+estimateInToken(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+balanceOfToken() : uint256</tspan><tspan x="5" dy="10">+panic() : uint256</tspan><tspan x="5" dy="10">+batchWithdraw()</tspan><tspan x="5" dy="10">+claimNextBatchAndDistribute(uint256 maxNumRequests) (bool, uint256)</tspan><tspan x="5" dy="10">+claimNextBatch() : bool</tspan><tspan x="5" dy="10">+distributeFund(uint256 maxNumRequests) : uint256</tspan><tspan x="5" dy="10">+distributeManual(address recipient)</tspan><tspan x="5" dy="10">+harvest()</tspan><tspan x="5" dy="10">+calculateYield() : uint256</tspan><tspan x="5" dy="10">+changeStakeManager(address stakeManager)</tspan><tspan x="5" dy="10">+getWithdrawRequests(address account) : UserWithdrawRequest[]</tspan></text></g><g id="classid-BnbxYieldConverterStrategy-30" class="classGroup" transform="translate(495.2890625,482.78125 )"><rect x="0" y="0" width="440.6953125" height="299.69140625" class=" "></rect><text y="15" x="0"><tspan class="title" x="154.4296875">BnbxYieldConverterStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="440.6953125"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">+IERC20Upgradeable _bnbxToken</tspan><tspan x="5" dy="10">+IStakeManager _stakeManager</tspan><tspan x="5" dy="10">+uint256 _firstDistributeIdx</tspan><tspan x="5" dy="10">+uint256 _nextWithdrawIdx</tspan><tspan x="5" dy="10">+uint256 bnbDepositBalance</tspan><tspan x="5" dy="10">+uint256 bnbxToUnstake</tspan><tspan x="5" dy="10">+uint256 bnbToDistribute</tspan><tspan x="5" dy="10">+uint256 lastUnstakeTriggerTime</tspan></text><line x1="0" y1="108.1015625" y2="108.1015625" x2="440.6953125"></line><text x="5" y="123.1015625" fill="white" class="classText"><tspan x="5">+mapping(uint256 =&gt; UserWithdrawRequest) : _withdrawRequests</tspan><tspan x="5" dy="10">+mapping(address =&gt; uint256) : manualWithdrawAmount</tspan><tspan x="5" dy="10">+initialize(address destination, address rewardsAddr, address bnbxToken, address masterVault)</tspan><tspan x="5" dy="10">+deposit() : uint256</tspan><tspan x="5" dy="10">+depositAll()</tspan><tspan x="5" dy="10">+withdraw(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+withdrawInToken(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+estimateInToken(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+balanceOfToken() : uint256</tspan><tspan x="5" dy="10">+panic() : uint256</tspan><tspan x="5" dy="10">+batchWithdraw()</tspan><tspan x="5" dy="10">+claimNextBatchAndDistribute(uint256 maxNumRequests) (bool, uint256)</tspan><tspan x="5" dy="10">+claimNextBatch() : bool</tspan><tspan x="5" dy="10">+distributeFund(uint256 maxNumRequests) : uint256</tspan><tspan x="5" dy="10">+distributeManual(address recipient)</tspan><tspan x="5" dy="10">+harvest()</tspan><tspan x="5" dy="10">+calculateYield() : uint256</tspan><tspan x="5" dy="10">+changeStakeManager(address stakeManager)</tspan></text></g><g id="classid-CerosYieldConverterStrategy-31" class="classGroup" transform="translate(985.984375,537.806640625 )"><rect x="0" y="0" width="591.8203125" height="189.640625" class=" "></rect><text y="15" x="0"><tspan class="title" x="228.5390625">CerosYieldConverterStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="591.8203125"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">+ICerosRouter _ceRouter</tspan><tspan x="5" dy="10">+ICertToken _certToken</tspan><tspan x="5" dy="10">+IBinancePool _binancePool</tspan><tspan x="5" dy="10">+IVault _ceVault</tspan></text><line x1="0" y1="68.05078125" y2="68.05078125" x2="591.8203125"></line><text x="5" y="83.05078125" fill="white" class="classText"><tspan x="5">+initialize(address destination, address rewards, address certToken, address masterVault, address binancePool, address ceVault)</tspan><tspan x="5" dy="10">+deposit() : uint256</tspan><tspan x="5" dy="10">+depositAll()</tspan><tspan x="5" dy="10">+withdraw(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+panic() : uint256</tspan><tspan x="5" dy="10">+withdrawInToken(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+estimateInToken(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+balanceOfToken() : uint256</tspan><tspan x="5" dy="10">+harvest()</tspan><tspan x="5" dy="10">+changeBinancePool(address binancePool)</tspan><tspan x="5" dy="10">+changeCeRouter(address ceRouter)</tspan></text></g><g id="classid-StkBnbStrategy-32" class="classGroup" transform="translate(1627.8046875,482.806640625 )"><rect x="0" y="0" width="512.515625" height="299.640625" class=" "></rect><text y="15" x="0"><tspan class="title" x="220.92578125">StkBnbStrategy</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="512.515625"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">+IAddressStore _addressStore</tspan><tspan x="5" dy="10">+uint256 _bnbDepositsInStakePool</tspan><tspan x="5" dy="10">+uint256 _bnbToDistribute</tspan><tspan x="5" dy="10">+uint256 _startIndex</tspan><tspan x="5" dy="10">+uint256 _endIndex</tspan></text><line x1="0" y1="78.05078125" y2="78.05078125" x2="512.515625"></line><text x="5" y="93.05078125" fill="white" class="classText"><tspan x="5">+mapping(uint256 =&gt; WithdrawRequest) : withdrawReqs</tspan><tspan x="5" dy="10">+mapping(address =&gt; uint256) : manualWithdrawAmount</tspan><tspan x="5" dy="10">+initialize(address destination, address rewards, address masterVault, address addressStore)</tspan><tspan x="5" dy="10">+deposit() : uint256</tspan><tspan x="5" dy="10">+depositAll()</tspan><tspan x="5" dy="10">+withdraw(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+withdrawInToken(address recipient, uint256 amount) : uint256</tspan><tspan x="5" dy="10">+estimateInToken(uint256 amount) : uint256</tspan><tspan x="5" dy="10">+balanceOfToken() : uint256</tspan><tspan x="5" dy="10">+panic() : uint256</tspan><tspan x="5" dy="10">+batchWithdraw()</tspan><tspan x="5" dy="10">+claimAndDistribute()</tspan><tspan x="5" dy="10">+claimAll()</tspan><tspan x="5" dy="10">+claim(uint256 index)</tspan><tspan x="5" dy="10">+distribute(uint256 endIdx)</tspan><tspan x="5" dy="10">+distributeManual(address recipient)</tspan><tspan x="5" dy="10">+harvest()</tspan><tspan x="5" dy="10">+calculateYield() : uint256</tspan><tspan x="5" dy="10">+changeAddressStore(address addressStore)</tspan><tspan x="5" dy="10">+tokensReceived(address operator, address from, address to, uint256 amount, bytes data, bytes operatorData)</tspan><tspan x="5" dy="10">+setInterfaceImplementer()</tspan></text></g><path d="M998.765625,208.140625L998.765625,212.30729166666666C998.765625,216.47395833333334,998.765625,224.80729166666666,998.765625,233.140625C998.765625,241.47395833333334,998.765625,249.80729166666666,998.765625,253.97395833333334L998.765625,258.140625" id="edge21" class="relation" marker-start="url(#extensionStart)"></path><path d="M789.51953125,372.5690380787369L695.0403645833334,385.93774006561415C600.5611979166666,399.30644205249126,411.6028645833333,426.0438460262456,317.1236979166667,443.57921467978946C222.64453125,461.1145833333333,222.64453125,469.4479166666667,222.64453125,473.6145833333333L222.64453125,477.78125" id="edge22" class="relation" marker-start="url(#extensionStart)"></path><path d="M789.51953125,424.1235136190864L777.2057291666666,428.8998030159053C764.8919270833334,433.6760924127243,740.2643229166666,443.22867120636215,727.9505208333334,453.004960603181C715.63671875,462.78125,715.63671875,472.78125,715.63671875,477.78125L715.63671875,482.78125" id="edge23" class="relation" marker-start="url(#extensionStart)"></path><path d="M1208.01171875,424.1235136190864L1220.3255208333333,428.8998030159053C1232.6393229166667,433.6760924127243,1257.2669270833333,443.22867120636215,1269.5807291666667,462.175859040681C1281.89453125,481.123046875,1281.89453125,509.46484375,1281.89453125,523.6357421875L1281.89453125,537.806640625" id="edge24" class="relation" marker-start="url(#extensionStart)"></path><path d="M1208.01171875,368.9177346535303L1320.6868489583333,382.8949872112753C1433.3619791666667,396.87223976902015,1658.7122395833333,424.8267448845101,1771.3873697916667,443.8082292130884C1884.0625,462.7897135416667,1884.0625,472.7981770833333,1884.0625,477.8024088541667L1884.0625,482.806640625" id="edge25" class="relation" marker-start="url(#extensionStart)"></path></svg></pre>
<p>现在线上bot只会操作一个策略SnBnbYieldConverterStrategy，合约地址是：<br>
0x6F28FeC449dbd2056b76ac666350Af8773E03873</p>
<p>其他的策略虽然配置了，但是没有用</p>
<h2 id="bnbstakingpool_r4继承关系">BNBStakingPool_R4继承关系</h2>
<pre class=" language-mermaid"><svg id="mermaid-svg-seq2p2w0XX7348ta" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="220.7421875" style="max-width: 662.7265625px;" viewBox="-20 -20 662.7265625 220.7421875"><style>#mermaid-svg-seq2p2w0XX7348ta{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-seq2p2w0XX7348ta .error-icon{fill:#552222;}#mermaid-svg-seq2p2w0XX7348ta .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-seq2p2w0XX7348ta .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-seq2p2w0XX7348ta .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-seq2p2w0XX7348ta .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-seq2p2w0XX7348ta .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-seq2p2w0XX7348ta .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-seq2p2w0XX7348ta .marker{fill:#666;stroke:#666;}#mermaid-svg-seq2p2w0XX7348ta .marker.cross{stroke:#666;}#mermaid-svg-seq2p2w0XX7348ta svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-seq2p2w0XX7348ta g.classGroup text{fill:#999;fill:#111111;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-svg-seq2p2w0XX7348ta g.classGroup text .title{font-weight:bolder;}#mermaid-svg-seq2p2w0XX7348ta .classTitle{font-weight:bolder;}#mermaid-svg-seq2p2w0XX7348ta .node rect,#mermaid-svg-seq2p2w0XX7348ta .node circle,#mermaid-svg-seq2p2w0XX7348ta .node ellipse,#mermaid-svg-seq2p2w0XX7348ta .node polygon,#mermaid-svg-seq2p2w0XX7348ta .node path{fill:#eee;stroke:#999;stroke-width:1px;}#mermaid-svg-seq2p2w0XX7348ta .divider{stroke:#999;stroke:1;}#mermaid-svg-seq2p2w0XX7348ta g.clickable{cursor:pointer;}#mermaid-svg-seq2p2w0XX7348ta g.classGroup rect{fill:#eee;stroke:#999;}#mermaid-svg-seq2p2w0XX7348ta g.classGroup line{stroke:#999;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta .classLabel .box{stroke:none;stroke-width:0;fill:#eee;opacity:0.5;}#mermaid-svg-seq2p2w0XX7348ta .classLabel .label{fill:#999;font-size:10px;}#mermaid-svg-seq2p2w0XX7348ta .relation{stroke:#666;stroke-width:1;fill:none;}#mermaid-svg-seq2p2w0XX7348ta .dashed-line{stroke-dasharray:3;}#mermaid-svg-seq2p2w0XX7348ta #compositionStart,#mermaid-svg-seq2p2w0XX7348ta .composition{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #compositionEnd,#mermaid-svg-seq2p2w0XX7348ta .composition{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #dependencyStart,#mermaid-svg-seq2p2w0XX7348ta .dependency{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #dependencyStart,#mermaid-svg-seq2p2w0XX7348ta .dependency{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #extensionStart,#mermaid-svg-seq2p2w0XX7348ta .extension{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #extensionEnd,#mermaid-svg-seq2p2w0XX7348ta .extension{fill:#666 !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #aggregationStart,#mermaid-svg-seq2p2w0XX7348ta .aggregation{fill:#eee !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta #aggregationEnd,#mermaid-svg-seq2p2w0XX7348ta .aggregation{fill:#eee !important;stroke:#666 !important;stroke-width:1;}#mermaid-svg-seq2p2w0XX7348ta .edgeTerminals{font-size:11px;}#mermaid-svg-seq2p2w0XX7348ta:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-seq2p2w0XX7348ta class{fill:apa;}</style><g></g><defs><marker id="extensionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker id="extensionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker id="compositionStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="compositionEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="aggregationEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyStart" class="extension" refX="0" refY="7" markerWidth="190" markerHeight="240" orient="auto"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker id="dependencyEnd" refX="19" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><g id="classid-IBNBStakingPool-33" class="classGroup" transform="translate(0,0 )"><rect x="0" y="0" width="340.7734375" height="88.140625" class=" "></rect><text y="15" x="0"><tspan class="title" x="132.9765625">IBNBStakingPool</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="340.7734375"></line><text x="5" y="31.55078125" fill="white" class="classText"></text><line x1="0" y1="26.55078125" y2="26.55078125" x2="340.7734375"></line><text x="5" y="41.55078125" fill="white" class="classText"><tspan x="5">+stakeCerts() : external payable</tspan><tspan x="5" dy="10">+unstakeCertsFor(address receiverAddress, uint256 shares) : external</tspan><tspan x="5" dy="10">+getMinStake() external view returns (uint256)</tspan><tspan x="5" dy="10">+getMinUnstake() external view returns (uint256)</tspan><tspan x="5" dy="10">+getPendingUnstakesOf(address claimer) external view returns (uint256)</tspan></text></g><g id="classid-BNBStakingPool_R4-34" class="classGroup" transform="translate(245.208984375,138.140625 )"><rect x="0" y="0" width="186.71875" height="42.6015625" class=" "></rect><text y="15" x="0"><tspan class="title" x="48.42578125">BNBStakingPool_R4</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="186.71875"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">// BNBStakingPool_R4 的具体内容省略</tspan></text><line x1="0" y1="38.1015625" y2="38.1015625" x2="186.71875"></line><text x="5" y="53.1015625" fill="white" class="classText"></text></g><g id="classid-MixedLiquidTokenStakingPool-35" class="classGroup" transform="translate(390.7734375,22.76953125 )"><rect x="0" y="0" width="231.953125" height="42.6015625" class=" "></rect><text y="15" x="0"><tspan class="title" x="47.16015625">MixedLiquidTokenStakingPool</tspan></text><line x1="0" y1="21.55078125" y2="21.55078125" x2="231.953125"></line><text x="5" y="31.55078125" fill="white" class="classText"><tspan x="5">// MixedLiquidTokenStakingPool 的具体内容省略</tspan></text><line x1="0" y1="38.1015625" y2="38.1015625" x2="231.953125"></line><text x="5" y="53.1015625" fill="white" class="classText"></text></g><path d="M170.38671875,88.140625L170.38671875,92.30729166666667C170.38671875,96.47395833333333,170.38671875,104.80729166666667,185.52160021460813,113.140625C200.65648167921623,121.47395833333333,230.92624460843248,129.80729166666666,246.06112607304058,133.97395833333334L261.1960075376487,138.140625" id="edge26" class="relation" marker-start="url(#extensionStart)"></path><path d="M506.75,65.37109375L506.75,73.33268229166667C506.75,81.29427083333333,506.75,97.21744791666667,491.6151185353919,109.345703125C476.48023707078374,121.47395833333333,446.21047414156754,129.80729166666666,431.0755926769594,133.97395833333334L415.9407112123513,138.140625" id="edge27" class="relation" marker-start="url(#extensionStart)"></path></svg></pre>
<h2 id="充值流程">充值流程</h2>
<pre class=" language-mermaid"><svg id="mermaid-svg-T2Q7m2U14RLi9Xys" width="100%" xmlns="http://www.w3.org/2000/svg" height="2265" style="max-width: 2514px;" viewBox="-50 -10 2514 2265"><style>#mermaid-svg-T2Q7m2U14RLi9Xys{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-T2Q7m2U14RLi9Xys .error-icon{fill:#552222;}#mermaid-svg-T2Q7m2U14RLi9Xys .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-T2Q7m2U14RLi9Xys .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-T2Q7m2U14RLi9Xys .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-T2Q7m2U14RLi9Xys .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-T2Q7m2U14RLi9Xys .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-T2Q7m2U14RLi9Xys .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-T2Q7m2U14RLi9Xys .marker{fill:#666;stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys .marker.cross{stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-T2Q7m2U14RLi9Xys .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-T2Q7m2U14RLi9Xys text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-T2Q7m2U14RLi9Xys .actor-line{stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys .sequenceNumber{fill:white;}#mermaid-svg-T2Q7m2U14RLi9Xys #sequencenumber{fill:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys .messageText{fill:#333;stroke:#333;}#mermaid-svg-T2Q7m2U14RLi9Xys .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-T2Q7m2U14RLi9Xys .labelText,#mermaid-svg-T2Q7m2U14RLi9Xys .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-T2Q7m2U14RLi9Xys .loopText,#mermaid-svg-T2Q7m2U14RLi9Xys .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-T2Q7m2U14RLi9Xys .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-T2Q7m2U14RLi9Xys .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-T2Q7m2U14RLi9Xys .noteText,#mermaid-svg-T2Q7m2U14RLi9Xys .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-T2Q7m2U14RLi9Xys .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-T2Q7m2U14RLi9Xys:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-T2Q7m2U14RLi9Xys sequence{fill:apa;}</style><g></g><g><line id="actor69" x1="75" y1="5" x2="75" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">用户</tspan></text></g><g><line id="actor70" x1="382" y1="5" x2="382" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="307" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="382" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="382" dy="0">HelioProviderV2</tspan></text></g><g><line id="actor71" x1="582" y1="5" x2="582" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="507" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="582" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="582" dy="0">StrategyBotService</tspan></text></g><g><line id="actor72" x1="1009" y1="5" x2="1009" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="934" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1009" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1009" dy="0">MasterVault</tspan></text></g><g><line id="actor73" x1="1259" y1="5" x2="1259" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1152.5" y="0" fill="#eaeaea" stroke="#666" width="213" height="65" rx="3" ry="3" class="actor"></rect><text x="1259" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1259" dy="0">SnBnbYieldConverterStrategy</tspan></text></g><g><line id="actor74" x1="1509" y1="5" x2="1509" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1434" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1509" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1509" dy="0">ListaStakeManager</tspan></text></g><g><line id="actor75" x1="1796" y1="5" x2="1796" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1721" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1796" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1796" dy="0">BotService</tspan></text></g><g><line id="actor76" x1="2139" y1="5" x2="2139" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2064" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2139" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2139" dy="0">Validators</tspan></text></g><g><line id="actor77" x1="2339" y1="5" x2="2339" y2="2254" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2264" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2339" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2339" dy="0">Dao(Interaction)</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><rect x="100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="175" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="175">存款流程</tspan></text></g><text x="229" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">provide() - 存款</text><line x1="75" y1="167" x2="382" y2="167" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="696" y="182" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">depositETH()存入BNB</text><line x1="382" y1="223" x2="1009" y2="223" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1009" y="238" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">评估存款费用(depositFee=0)</text><path d="M 1009,279 C 1069,269 1069,309 1009,299" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1009" y="324" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新总的手续费收入(0)</text><path d="M 1009,357 C 1069,347 1069,387 1009,377" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="696" y="402" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">mint ceABNBc to HelioProviderV2(amount=value)</text><line x1="1009" y1="443" x2="382" y2="443" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="696" y="458" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">返回存款份额value</text><line x1="1009" y1="491" x2="382" y2="491" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1361" y="506" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">deposit(usr,ceABNBc,value)</text><line x1="382" y1="547" x2="2339" y2="547" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="229" y="562" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">min hBNB to usr(amount=value)</text><line x1="382" y1="603" x2="75" y2="603" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="229" y="618" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">返回存款份额</text><line x1="382" y1="651" x2="75" y2="651" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="607" y="661" fill="#EDF2AE" stroke="#666" width="377" height="36" rx="0" ry="0" class="note"></rect><text x="796" y="666" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="796">转移BNB, MasterVault=&gt;Strategy=&gt;ListaStakeManager</tspan></text></g><text x="582" y="712" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Cron每天一次depositToStrategy</text><path d="M 582,753 C 642,743 642,783 582,773" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="582" y="798" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算总金额15%cacheAmount(??)</text><path d="M 582,839 C 642,829 642,869 582,859" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="582" y="884" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算充值到策略金额depositAmount</text><path d="M 582,925 C 642,915 642,955 582,945" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="796" y="970" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">depositToStrategy(strategy, depositAmount)</text><line x1="582" y1="1011" x2="1009" y2="1011" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1134" y="1026" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">deposit{value: amount}()</text><line x1="1009" y1="1067" x2="1259" y2="1067" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1259" y="1082" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新bnbDepositBalance</text><path d="M 1259,1123 C 1319,1113 1319,1153 1259,1143" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1384" y="1168" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">deposit{value: amount}()</text><line x1="1259" y1="1209" x2="1509" y2="1209" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1509" y="1224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算需要mint多少slisBNB</text><path d="M 1509,1265 C 1569,1255 1569,1295 1509,1285" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1509" y="1310" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">amountToDelegate += amount</text><path d="M 1509,1351 C 1569,1341 1569,1381 1509,1371" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1384" y="1396" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">mint: slisBnbToMint</text><line x1="1509" y1="1437" x2="1259" y2="1437" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="1821" y="1447" fill="#EDF2AE" stroke="#666" width="293" height="36" rx="0" ry="0" class="note"></rect><text x="1968" y="1452" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="1968">转移BNB, ListaStakeManager=&gt;Validators</tspan></text></g><text x="1796" y="1498" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Cron每天一次delegateTo</text><path d="M 1796,1539 C 1856,1529 1856,1569 1796,1559" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1653" y="1584" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">amountToDelegate()</text><line x1="1796" y1="1625" x2="1509" y2="1625" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1653" y="1640" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">amountToDelegate</text><line x1="1509" y1="1681" x2="1796" y2="1681" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1653" y="1696" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">获取每个validator质押余额</text><line x1="1796" y1="1729" x2="1509" y2="1729" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1796" y="1744" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算总的余额</text><path d="M 1796,1777 C 1856,1767 1856,1807 1796,1797" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1796" y="1822" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">根据每个validator配置份额重新计算质押量</text><path d="M 1796,1855 C 1856,1845 1856,1885 1796,1875" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1653" y="1900" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">delegateTo(validator,amount)</text><line x1="1796" y1="1941" x2="1509" y2="1941" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1509" y="1956" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新amountToDelegate</text><path d="M 1509,1997 C 1569,1987 1569,2027 1509,2017" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1509" y="2042" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新totalDelegated</text><path d="M 1509,2083 C 1569,2073 1569,2113 1509,2103" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1824" y="2128" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">将amount委托给validator</text><line x1="1509" y1="2169" x2="2139" y2="2169" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="0" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">用户</tspan></text></g><g><rect x="307" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="382" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="382" dy="0">HelioProviderV2</tspan></text></g><g><rect x="507" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="582" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="582" dy="0">StrategyBotService</tspan></text></g><g><rect x="934" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1009" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1009" dy="0">MasterVault</tspan></text></g><g><rect x="1152.5" y="2189" fill="#eaeaea" stroke="#666" width="213" height="65" rx="3" ry="3" class="actor"></rect><text x="1259" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1259" dy="0">SnBnbYieldConverterStrategy</tspan></text></g><g><rect x="1434" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1509" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1509" dy="0">ListaStakeManager</tspan></text></g><g><rect x="1721" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1796" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1796" dy="0">BotService</tspan></text></g><g><rect x="2064" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2139" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2139" dy="0">Validators</tspan></text></g><g><rect x="2264" y="2189" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2339" y="2221.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2339" dy="0">Dao(Interaction)</tspan></text></g></svg></pre>
<h2 id="取款流程">取款流程</h2>
<pre class=" language-mermaid"><svg id="mermaid-svg-7tGfxYsC6EaNAqaK" width="100%" xmlns="http://www.w3.org/2000/svg" height="3955" style="max-width: 2708.5px;" viewBox="-50 -10 2708.5 3955"><style>#mermaid-svg-7tGfxYsC6EaNAqaK{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-7tGfxYsC6EaNAqaK .error-icon{fill:#552222;}#mermaid-svg-7tGfxYsC6EaNAqaK .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-7tGfxYsC6EaNAqaK .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-7tGfxYsC6EaNAqaK .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-7tGfxYsC6EaNAqaK .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-7tGfxYsC6EaNAqaK .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-7tGfxYsC6EaNAqaK .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-7tGfxYsC6EaNAqaK .marker{fill:#666;stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK .marker.cross{stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-7tGfxYsC6EaNAqaK .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-7tGfxYsC6EaNAqaK text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-7tGfxYsC6EaNAqaK .actor-line{stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK .sequenceNumber{fill:white;}#mermaid-svg-7tGfxYsC6EaNAqaK #sequencenumber{fill:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK .messageText{fill:#333;stroke:#333;}#mermaid-svg-7tGfxYsC6EaNAqaK .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-7tGfxYsC6EaNAqaK .labelText,#mermaid-svg-7tGfxYsC6EaNAqaK .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-7tGfxYsC6EaNAqaK .loopText,#mermaid-svg-7tGfxYsC6EaNAqaK .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-7tGfxYsC6EaNAqaK .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-7tGfxYsC6EaNAqaK .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-7tGfxYsC6EaNAqaK .noteText,#mermaid-svg-7tGfxYsC6EaNAqaK .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-7tGfxYsC6EaNAqaK .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-7tGfxYsC6EaNAqaK:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-7tGfxYsC6EaNAqaK sequence{fill:apa;}</style><g></g><g><line id="actor78" x1="75" y1="5" x2="75" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">用户</tspan></text></g><g><line id="actor79" x1="388" y1="5" x2="388" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="313" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="388" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="388" dy="0">HelioProviderV2</tspan></text></g><g><line id="actor80" x1="654" y1="5" x2="654" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="578.5" y="0" fill="#eaeaea" stroke="#666" width="151" height="65" rx="3" ry="3" class="actor"></rect><text x="654" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="654" dy="0">BNBStakingPool_R4</tspan></text></g><g><line id="actor81" x1="854.5" y1="5" x2="854.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="779.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="854.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="854.5" dy="0">StrategyBotService</tspan></text></g><g><line id="actor82" x1="1058.5" y1="5" x2="1058.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="983.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1058.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1058.5" dy="0">MasterVault</tspan></text></g><g><line id="actor83" x1="1336.5" y1="5" x2="1336.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1230" y="0" fill="#eaeaea" stroke="#666" width="213" height="65" rx="3" ry="3" class="actor"></rect><text x="1336.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1336.5" dy="0">SnBnbYieldConverterStrategy</tspan></text></g><g><line id="actor84" x1="1676.5" y1="5" x2="1676.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="1601.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1676.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1676.5" dy="0">ListaStakeManager</tspan></text></g><g><line id="actor85" x1="2117.5" y1="5" x2="2117.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2042.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2117.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2117.5" dy="0">BotService</tspan></text></g><g><line id="actor86" x1="2333.5" y1="5" x2="2333.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2258.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2333.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2333.5" dy="0">STAKE_HUB</tspan></text></g><g><line id="actor87" x1="2533.5" y1="5" x2="2533.5" y2="3944" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="2458.5" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2533.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2533.5" dy="0">Dao(Interaction)</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><rect x="100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="175" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="175">取款流程</tspan></text></g><text x="232" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">release(amount) - 取款</text><line x1="75" y1="167" x2="388" y2="167" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="521" y="182" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">_pool.getMinUnstake()</text><line x1="388" y1="223" x2="654" y2="223" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="521" y="238" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">最小金额minumumUnstake</text><line x1="654" y1="279" x2="388" y2="279" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1461" y="294" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">withdraw(usr,ceABNBc,amount)</text><line x1="388" y1="335" x2="2533.5" y2="335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="232" y="350" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">burn hBNB to usr(amount=value)</text><line x1="388" y1="391" x2="75" y2="391" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="723" y="406" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">withdrawETH(recipient,amount)提取BNB</text><line x1="388" y1="447" x2="1058.5" y2="447" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="723" y="462" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">burn ceABNBc in HelioProviderV2(amount=value)</text><line x1="1058.5" y1="503" x2="388" y2="503" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1059" y="518" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算当前合约总资产(totalAssetInVault())</text><path d="M 1058.5,559 C 1118.5,549 1118.5,589 1058.5,579" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="604" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">评估取款费用(withdrawalFee=0)</text><path d="M 1058.5,645 C 1118.5,635 1118.5,675 1058.5,665" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="690" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新总的手续费收入(0)</text><path d="M 1058.5,723 C 1118.5,713 1118.5,753 1058.5,743" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="768" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">当前的余额ethBalance够</text><path d="M 1058.5,809 C 1118.5,799 1118.5,839 1058.5,829" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="567" y="854" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">transfer BNB to User(amount)</text><line x1="1058.5" y1="895" x2="75" y2="895" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1059" y="910" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">当前的余额ethBalance不够</text><path d="M 1058.5,951 C 1118.5,941 1118.5,981 1058.5,971" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="567" y="996" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">transfer BNB to user(ethBalance)</text><line x1="1058.5" y1="1037" x2="75" y2="1037" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1059" y="1052" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">withdrawFromActiveStrategies</text><path d="M 1058.5,1093 C 1118.5,1083 1118.5,1123 1058.5,1113" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="1138" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">遍历有效Strategy</text><path d="M 1058.5,1179 C 1118.5,1169 1118.5,1209 1058.5,1199" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="1224" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">如果当前质押量够直接提取amount</text><path d="M 1058.5,1265 C 1118.5,1255 1118.5,1295 1058.5,1285" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="1310" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">如果之前质押量不够提取所有debt，继续下一个策略</text><path d="M 1058.5,1343 C 1118.5,1333 1118.5,1373 1058.5,1363" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><g><rect x="1083.5" y="1383" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="1159" y="1388" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="1159">从Strategy提现</tspan></text></g><text x="1059" y="1434" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">_withdrawFromStrategy(strategy,recipient,amount)</text><path d="M 1058.5,1475 C 1118.5,1465 1118.5,1505 1058.5,1495" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1198" y="1520" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">withdraw(recipient, amount)</text><line x1="1058.5" y1="1553" x2="1336.5" y2="1553" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="1361.5" y="1563" fill="#EDF2AE" stroke="#666" width="213" height="36" rx="0" ry="0" class="note"></rect><text x="1468" y="1568" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="1468">Strategy提现</tspan></text></g><text x="1507" y="1614" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">convertBnbToSnBnb(amount)</text><line x1="1336.5" y1="1655" x2="1676.5" y2="1655" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1677" y="1670" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算对应slisBNB数量</text><path d="M 1676.5,1711 C 1736.5,1701 1736.5,1741 1676.5,1731" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1507" y="1756" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">slisBNB数量snBnbAmount</text><line x1="1676.5" y1="1797" x2="1336.5" y2="1797" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1337" y="1812" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新bnbDepositBalance、snBnbToUnstake</text><path d="M 1336.5,1853 C 1396.5,1843 1396.5,1883 1336.5,1873" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1337" y="1898" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">将提现金额登记下_withdrawRequests</text><path d="M 1336.5,1939 C 1396.5,1929 1396.5,1969 1336.5,1959" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1198" y="1984" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">返回提现金额value</text><line x1="1336.5" y1="2017" x2="1058.5" y2="2017" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1059" y="2032" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新总债务totalDebt</text><path d="M 1058.5,2073 C 1118.5,2063 1118.5,2103 1058.5,2093" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1059" y="2118" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新Strategy债务debt</text><path d="M 1058.5,2159 C 1118.5,2149 1118.5,2189 1058.5,2179" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="723" y="2204" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">返回提取金额realAmount</text><line x1="1058.5" y1="2245" x2="388" y2="2245" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="232" y="2260" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">realAmount</text><line x1="388" y1="2301" x2="75" y2="2301" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="879.5" y="2311" fill="#EDF2AE" stroke="#666" width="154" height="36" rx="0" ry="0" class="note"></rect><text x="957" y="2316" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="957">从Strategy提现(登记)</tspan></text></g><text x="855" y="2362" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Cron每10mins一次batchWithdraw</text><path d="M 854.5,2403 C 914.5,2393 914.5,2433 854.5,2423" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1096" y="2448" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">batchWithdraw</text><line x1="854.5" y1="2489" x2="1336.5" y2="2489" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1507" y="2504" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">requestWithdraw(snBnbToUnstake_)</text><line x1="1336.5" y1="2545" x2="1676.5" y2="2545" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1677" y="2560" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算slisBNB转成BNB数量bnbToWithdraw</text><path d="M 1676.5,2601 C 1736.5,2591 1736.5,2631 1676.5,2621" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1677" y="2646" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">更新totalAmount、totalAmountInSlisBnb</text><path d="M 1676.5,2687 C 1736.5,2677 1736.5,2717 1676.5,2707" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1677" y="2732" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">登记提现请求userWithdrawalRequests</text><path d="M 1676.5,2773 C 1736.5,2763 1736.5,2803 1676.5,2793" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1677" y="2818" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">登记提现请求withdrawalQueue</text><path d="M 1676.5,2859 C 1736.5,2849 1736.5,2889 1676.5,2879" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1507" y="2904" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">从策略转账slisBNB到本合约</text><line x1="1676.5" y1="2945" x2="1336.5" y2="2945" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="2142.5" y="2955" fill="#EDF2AE" stroke="#666" width="166" height="36" rx="0" ry="0" class="note"></rect><text x="2226" y="2960" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="2226">从validator undelegate</tspan></text></g><text x="2118" y="3006" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">Cron每天一次undelegateFrom</text><path d="M 2117.5,3047 C 2177.5,3037 2177.5,3077 2117.5,3067" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1897" y="3092" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">getAmountToUndelegate()</text><line x1="2117.5" y1="3133" x2="1676.5" y2="3133" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1897" y="3148" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">reserveAmount()</text><line x1="2117.5" y1="3189" x2="1676.5" y2="3189" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="2142.5" y="3199" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="2218" y="3204" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="2218">两阶段提交，预提交</tspan></text></g><text x="1897" y="3250" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">try undelegateFrom()</text><line x1="2117.5" y1="3291" x2="1676.5" y2="3291" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1897" y="3306" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">get availableValidators</text><line x1="1676.5" y1="3347" x2="2117.5" y2="3347" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1897" y="3362" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">getDelegated(validator)获取delegated金额</text><line x1="2117.5" y1="3403" x2="1676.5" y2="3403" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="2118" y="3418" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算最大的validator金额maxDelegated</text><path d="M 2117.5,3459 C 2177.5,3449 2177.5,3489 2117.5,3479" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="2118" y="3504" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">设置提取金额不大于maxDelegated</text><path d="M 2117.5,3545 C 2177.5,3535 2177.5,3575 2117.5,3565" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1897" y="3590" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">undelegateFrom(maxValidator,undelegateAmount)</text><line x1="2117.5" y1="3631" x2="1676.5" y2="3631" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="1677" y="3646" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算需要undelegate BNB金额_actualBnbAmount</text><path d="M 1676.5,3687 C 1736.5,3677 1736.5,3717 1676.5,3707" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="1677" y="3732" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">unbondingBnb+=_actualBnbAmount</text><path d="M 1676.5,3773 C 1736.5,3763 1736.5,3803 1676.5,3793" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="2005" y="3818" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">undelegate(_operator, _shares)</text><line x1="1676.5" y1="3859" x2="2333.5" y2="3859" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="0" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">用户</tspan></text></g><g><rect x="313" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="388" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="388" dy="0">HelioProviderV2</tspan></text></g><g><rect x="578.5" y="3879" fill="#eaeaea" stroke="#666" width="151" height="65" rx="3" ry="3" class="actor"></rect><text x="654" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="654" dy="0">BNBStakingPool_R4</tspan></text></g><g><rect x="779.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="854.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="854.5" dy="0">StrategyBotService</tspan></text></g><g><rect x="983.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1058.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1058.5" dy="0">MasterVault</tspan></text></g><g><rect x="1230" y="3879" fill="#eaeaea" stroke="#666" width="213" height="65" rx="3" ry="3" class="actor"></rect><text x="1336.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1336.5" dy="0">SnBnbYieldConverterStrategy</tspan></text></g><g><rect x="1601.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="1676.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="1676.5" dy="0">ListaStakeManager</tspan></text></g><g><rect x="2042.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2117.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2117.5" dy="0">BotService</tspan></text></g><g><rect x="2258.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2333.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2333.5" dy="0">STAKE_HUB</tspan></text></g><g><rect x="2458.5" y="3879" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="2533.5" y="3911.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="2533.5" dy="0">Dao(Interaction)</tspan></text></g></svg></pre>
<p>ListaStakeManager缓冲池实现用户在不超过一定金额的情况下实时提现到账，需要实现两个功能：</p>
<ul>
<li>在ListaStakeManager合约中添加一个提现方法</li>
<li>Bot delegateTo方法逻辑修改，保持staking manager和validator节点余额按一定比例平衡</li>
</ul>
<h2 id="在listastakemanager中提供withdraw方法">在ListaStakeManager中提供withdraw方法</h2>
<p>ListaStakeManager目前提供的提现方法是requestWithdraw将提现请求做一个登记。参考MasterVault提供一个withdraw方法，大致逻辑如下：</p>
<pre><code>function withdraw(uint256 _amountInSlisBnb)  
external  
override  
whenNotPaused  
{  
  require(_amountInSlisBnb &gt; 0, "Invalid Amount");  
  
  uint256 bnbToWithdraw = convertSnBnbToBnb(_amountInSlisBnb);  
  require(bnbToWithdraw &gt; minBnb, "Bnb amount is too small to withdraw");  
  require(bnbToWithdraw &lt;= amountToDelegate, "Not enough BNB to withdraw");  
  
  (bool sent, ) = payable(msg.sender).call{value: bnbToWithdraw}("");  
  require(sent, "transfer failed");  
  
  IERC20Upgradeable(slisBnb).safeTransferFrom(  
        msg.sender,  
        address(this),  
        _amountInSlisBnb  
    );  
  emit Withdraw(msg.sender, _amountInSlisBnb);  
}
</code></pre>
<p>如果余额不够，直接拒绝提现。</p>
<h3 id="支持手续费">支持手续费</h3>
<p>上面的逻辑做一点修改可以支持手续费，添加一个手续费率状态变量，withdraw逻辑参考MasterVault添加计算手续费逻辑。</p>
<h2 id="维持stakingmanager和validator余额平衡">维持StakingManager和Validator余额平衡</h2>
<p>Bot目前一天一次执行delegateTo将StakingManager中所有的余额(amountToDelegate)都转移到Validator节点。这个逻辑做一定调整，步骤：</p>
<ol>
<li>计算所有Validator已经delegate总金额totalDelegated</li>
<li>根据amountToDelegate和totalDelegated计算StakingManager金额是否低于15%</li>
<li>如果低于15%，不delegate到Validator</li>
<li>如果超过15%，超过的部分按现有的策略delegate到Validator</li>
</ol>
<h2 id="bnb-unstake">BNB Unstake</h2>
<pre class=" language-mermaid"><svg id="mermaid-svg-1kL6TfC3xIudKRzn" width="100%" xmlns="http://www.w3.org/2000/svg" height="1075" style="max-width: 1051px;" viewBox="-50 -10 1051 1075"><style>#mermaid-svg-1kL6TfC3xIudKRzn{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#000000;}#mermaid-svg-1kL6TfC3xIudKRzn .error-icon{fill:#552222;}#mermaid-svg-1kL6TfC3xIudKRzn .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-1kL6TfC3xIudKRzn .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1kL6TfC3xIudKRzn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1kL6TfC3xIudKRzn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1kL6TfC3xIudKRzn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1kL6TfC3xIudKRzn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1kL6TfC3xIudKRzn .marker{fill:#666;stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn .marker.cross{stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1kL6TfC3xIudKRzn .actor{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-1kL6TfC3xIudKRzn text.actor > tspan{fill:#333;stroke:none;}#mermaid-svg-1kL6TfC3xIudKRzn .actor-line{stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-svg-1kL6TfC3xIudKRzn .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-svg-1kL6TfC3xIudKRzn #arrowhead path{fill:#333;stroke:#333;}#mermaid-svg-1kL6TfC3xIudKRzn .sequenceNumber{fill:white;}#mermaid-svg-1kL6TfC3xIudKRzn #sequencenumber{fill:#333;}#mermaid-svg-1kL6TfC3xIudKRzn #crosshead path{fill:#333;stroke:#333;}#mermaid-svg-1kL6TfC3xIudKRzn .messageText{fill:#333;stroke:#333;}#mermaid-svg-1kL6TfC3xIudKRzn .labelBox{stroke:hsl(0,0%,83%);fill:#eee;}#mermaid-svg-1kL6TfC3xIudKRzn .labelText,#mermaid-svg-1kL6TfC3xIudKRzn .labelText > tspan{fill:#333;stroke:none;}#mermaid-svg-1kL6TfC3xIudKRzn .loopText,#mermaid-svg-1kL6TfC3xIudKRzn .loopText > tspan{fill:#333;stroke:none;}#mermaid-svg-1kL6TfC3xIudKRzn .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(0,0%,83%);fill:hsl(0,0%,83%);}#mermaid-svg-1kL6TfC3xIudKRzn .note{stroke:hsl(60,100%,23.3333333333%);fill:#ffa;}#mermaid-svg-1kL6TfC3xIudKRzn .noteText,#mermaid-svg-1kL6TfC3xIudKRzn .noteText > tspan{fill:#333;stroke:none;}#mermaid-svg-1kL6TfC3xIudKRzn .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-svg-1kL6TfC3xIudKRzn:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-1kL6TfC3xIudKRzn sequence{fill:apa;}</style><g></g><g><line id="actor88" x1="75" y1="5" x2="75" y2="1064" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><line id="actor89" x1="333" y1="5" x2="333" y2="1064" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="258" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="333" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="333" dy="0">ListaStakeManager</tspan></text></g><g><line id="actor90" x1="676" y1="5" x2="676" y2="1064" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="601" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="676" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="676" dy="0">BotService</tspan></text></g><g><line id="actor91" x1="876" y1="5" x2="876" y2="1064" class="actor-line" stroke-width="0.5px" stroke="#999"></line><rect x="801" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="876" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="876" dy="0">Validators</tspan></text></g><defs><marker id="arrowhead" refX="9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="16" refY="4"><path fill="black" stroke="#000000" stroke-width="1px" d="M 9,2 V 6 L16,4 Z" style="stroke-dasharray: 0, 0;"></path><path fill="none" stroke="#000000" stroke-width="1px" d="M 0,1 L 6,7 M 6,1 L 0,7" style="stroke-dasharray: 0, 0;"></path></marker></defs><defs><marker id="filled-head" refX="18" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"></circle></marker></defs><g><rect x="100" y="75" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="175" y="80" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="175">Unstake</tspan></text></g><text x="204" y="126" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">withdraw(slisBnbAmount)</text><line x1="75" y1="167" x2="333" y2="167" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="333" y="182" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算slisBNB对应的bnb金额</text><path d="M 333,223 C 393,213 393,253 333,243" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="333" y="268" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">bnbAmount大于最小金额且小于当前余额</text><path d="M 333,309 C 393,299 393,339 333,329" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="204" y="354" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">转账BNB给用户</text><line x1="333" y1="395" x2="75" y2="395" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="204" y="410" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">将用户slisBNB转到本合约</text><line x1="75" y1="451" x2="333" y2="451" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="701" y="461" fill="#EDF2AE" stroke="#666" width="150" height="36" rx="0" ry="0" class="note"></rect><text x="776" y="466" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"><tspan x="776">delegateTo</tspan></text></g><text x="676" y="512" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">每天一次执行delegateTo</text><path d="M 676,553 C 736,543 736,583 676,573" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="676" y="598" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算totalDelegated</text><path d="M 676,639 C 736,629 736,669 676,659" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="505" y="684" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">read amountToDelegate</text><line x1="676" y1="725" x2="333" y2="725" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="505" y="740" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">amountToDelegate</text><line x1="333" y1="781" x2="676" y2="781" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="676" y="796" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">计算amountToDelegate占比</text><path d="M 676,837 C 736,827 736,867 676,857" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></path><text x="505" y="882" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">delegateTo(validator,超过15%的部分)</text><line x1="676" y1="923" x2="333" y2="923" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><text x="605" y="938" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;">delegateTo(validator)</text><line x1="333" y1="979" x2="876" y2="979" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"></line><g><rect x="0" y="999" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="75" y="1031.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="75" dy="0">User</tspan></text></g><g><rect x="258" y="999" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="333" y="1031.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="333" dy="0">ListaStakeManager</tspan></text></g><g><rect x="601" y="999" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="676" y="1031.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="676" dy="0">BotService</tspan></text></g><g><rect x="801" y="999" fill="#eaeaea" stroke="#666" width="150" height="65" rx="3" ry="3" class="actor"></rect><text x="876" y="1031.5" dominant-baseline="central" alignment-baseline="central" class="actor" style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, &quot;sans-serif&quot;;"><tspan x="876" dy="0">Validators</tspan></text></g></svg></pre>
<h2 id="问题">问题</h2>
<p>清算BNB</p>
<p>会走HelioProviderV2#liquidation</p>
</div>
</body>

</html>
